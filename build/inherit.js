
var inherit,merge,owl,_;_=require("underscore");owl=require("deep_copy");merge=function(original,introduced,context,key){var Class,commonKeys,iKeys,iUniqKeys,oKeys,oUniqKeys,obj,ret,_i,_j,_k,_len,_len2,_len3;ret=(function(value){return context[key]=value;});if(!(original!=null)||!(introduced!=null)){return ret(owl.deepCopy(original||introduced||null));}else if(Object.prototype.toString.apply(original)==="[object Array]"&&Object.prototype.toString.apply(introduced)==="[object Array]"){return ret(owl.deepCopy(original.concat(introduced)));}else if(Object.prototype.toString.apply(original)==="[object String]"&&Object.prototype.toString.apply(introduced)==="[object String]"){return ret(owl.deepCopy(introduced));}else if(typeof original==="object"&&typeof introduced==="object"){obj={};oKeys=_.keys(original);iKeys=_.keys(introduced);commonKeys=_.intersection(oKeys,iKeys);oUniqKeys=_.difference(oKeys,commonKeys);iUniqKeys=_.difference(iKeys,commonKeys);for(_i=0,_len=commonKeys.length;_i<_len;_i++){key=commonKeys[_i];if(typeof original[key]==="function"&&typeof introduced[key]==="function"){obj[key]=(function(){var f,g;f=original[key];g=introduced[key];return function(){var args,f2,fSuper,gSuper,_this=this;args=_.toArray(arguments);fSuper=args[args.length-1];if(typeof fSuper==="object"&&fSuper.isSuper===true){args.pop();}else{fSuper={isSuper:true,uper:(function(){})};}
f2=function(){return f.apply(_this,args.concat([fSuper]));};gSuper={isSuper:true,uper:f2};return g.apply(this,args.concat([gSuper]));};})();}else{merge(original[key],introduced[key],obj,key);}}
for(_j=0,_len2=oUniqKeys.length;_j<_len2;_j++){key=oUniqKeys[_j];obj[key]=owl.deepCopy(original[key]);}
for(_k=0,_len3=iUniqKeys.length;_k<_len3;_k++){key=iUniqKeys[_k];obj[key]=owl.deepCopy(introduced[key]);}
return ret(obj);}else if(typeof original==="function"&&typeof introduced==="function"&&(original.prototype.isClass===true||introduced.prototype.isClass===true)){Class=function(){original.apply(this,arguments);introduced.apply(this,arguments);};merge(original.prototype,introduced.prototype,Class,"prototype");Class.prototype.constructor=Class;return ret(Class);}else{return ret(owl.deepCopy(introduced));}};inherit=function(){var a,b,c,sources,_i,_len;sources=_.toArray(arguments);a=sources[0];c={result:null};for(_i=0,_len=sources.length;_i<_len;_i++){b=sources[_i];merge(a,b,c,"result");a=c.result;}
return a;};module.exports={merge:merge,inherit:inherit};